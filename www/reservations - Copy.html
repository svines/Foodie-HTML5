<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Foodie</title>

<!-- Sets initial viewport load and disables zooming  -->
<meta name="viewport" content="initial-scale=1.0, width=device-width" />

<!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="mobile-web-app-capable" content="yes">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet">
<link href="css/styles.css" rel="stylesheet">
</head>
<body id="wrapper">
<div id="sidebar-wrapper">
	<nav id="nav">
		<ul class="sidebar-nav nav" id="navRight">
			<li class="menu-heading"><strong><a href="#">FOODIE</a></strong></li>
			<li><a class="sub" href="map.html">Chefs</a></li>
			<li><a class="sub" href="user-profile.html">My Profile</a></li>
			<li><a class="sub" href="reservations.html">My Orders</a></li>
		</ul>
	</nav>
</div>

<!-- Wrap all non-bar HTML in the .content div (this is actually what scrolls) -->
<div id="chef-page" class="content">
	<h1 id="menu-button"> <a id="menu-toggle" href="#" class="btn-menu toggle"> <i class="fa fa-bars"></i> </a> </h1>
	<h2 class="text-center">Reservations</h2>
	<div id="chef-foods">
		<div class="food-listing hidden">
			<div class="food-image-cont"> <img class="img-responsive img-circle media-object pull-left" src="images/food-1.png" align="food img"> </div>
			<div class="food-info-cont">
				<div class="food-info-body">
					<h4 class="dishTitle">Strawbery muffin</h4>
					<div class="byChef">From :</div>
					<p class="dishInfo"></p>
				</div>
			</div>
		</div>
		<div class="aLoading text-center" style="display:none"><img src="images/loading.gif" sytle=" margin: 0 auto;" /></div>
	</div>
</div>
<br />
<br />

<div class="modal fade" id="popFinish" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="popFinishTitle">Rate It</h4>
			</div>
			<div class="modal-body">
				<p>Please rate your level of satisfaction with the food and service you recieved.</p>
				
				<form method="post" id="frmF">
					<div class="form-group">
						<label class="">Your Rating</label>
						<div class="">
							<select name="rating" id="rating" class="form-control required">
								<option value="5">5/5 Excellent</option>
								<option value="4">4/5 Very Good</option>
								<option value="3">3/5 Good</option>
								<option value="2">2/5 Fair</option>
								<option value="1">1/5 Poor</option>
							</select>
						</div>
					</div>
					<input type="hidden" name="res_id" id="res_id" class="form-control required">
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-success finishGo">OK</button>
			</div>
		</div>
	</div>
</div>

<br />
<br />
<br />
<br />
<div id="bottom-bar">
	<div class="container">
		<div class="row">
			<div class="col-xs-4 no-padding"> <a class="tab-item" href="map.html"> <img class="tab-icon " src="images/map-icon.png" alt="map-icon"> 
				<!-- <i class="fa fa-map-o tab"></i> --> 
				<img class="border-image" src="images/border-image.png" alt="border-image"> </a> </div>
			<div class="col-xs-4 no-padding"> <a class="tab-item active" href="reservations.html"> <img class="tab-icon" src="images/food-icon.png" alt="food-icon"> <img class="border-image" src="images/border-image.png" alt="border-image"> </a> </div>
			<div class="col-xs-4 no-padding"> <a class="tab-item" href="user-profile.html"> <img class="tab-icon" src="images/profile-icon.png" alt="map-icon"> </a> </div>
		</div>
	</div>
</div>

<!-- Script --> 
<script src="js/jquery-1.11.3.min.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="js/jquery.validate.min.js"></script> 
<script src="js/common.js"></script> 
<script>



$(document).ready(function(e) {

	loadReservations();
	
	
	$('#chef-foods').on('click', '.btnFinish',function(){
		$('#res_id').val( $(this).data('rid') );
		$('#popFinish').modal();
	});
	
	$('.finishGo').on('click',function(){
		$('#frmF').submit();
	});
	
	$('#frmF').validate({
		errorPlacement: function(error, element) {},
		submitHandler: function(form) {
			
			formData = $(form).serialize();
			formData += '&userId='+localStorage.getItem('userId')+'&userToken='+localStorage.getItem('userToken'); 
			$.ajax({
				type: "POST", dataType: 'json', url: "http://mobileapi.foodiesys.com/foodie-mssql/ajax.php?h=rateDish", data: formData,
				beforeSend: function() { waitingDialog.show('Loading', {dialogSize: 'sm', progressType: 'info'}); },
				complete: function() { waitingDialog.hide(); },
			}).fail(  ajaxError )
			.done(function(data){
				if (data.Success == 'true') {
					$('#popFinish').modal('hide');
					BAlert.find('.modal-header h3').html('<i class="fa check"></i> Success');
					BAlert.find('.modal-body').html('<p class="text-success">'+data.Msg+'</p>');
					BAlert.modal();
				} else { 
					BAlert.find('.modal-header h3').html('<i class="fa fa-exclamation-triangle"></i> Error');
					BAlert.find('.modal-body').html('<p class="text-danger">'+data.Msg+'</p>');
					BAlert.modal();
				}
				if (data.JS) { eval(data.JS); }
			
			}); // ajax	
					
		}// submit handler
	});
	
	

});


function loadReservations(){
	formData = 'user_id='+ localStorage.getItem('userId');
	formData += '&userToken='+ localStorage.getItem('userToken');
	$.ajax({
		type: "POST", dataType: 'json', url: "http://mobileapi.foodiesys.com/foodie-mssql/ajax.php?h=getReservations", data: formData,
		beforeSend: function() { $('div.aLoading').show();  },
		complete: function() { $('div.aLoading').hide(); },
	}).fail(  ajaxError )
	.done(function(data){
		if (data.Success == 'true') {
			if(data.Count > 0 ){
				resData = data.Reservations;
				$DTemp = $('.food-listing');
				for (var i = 0; i < resData.length; i++) {
					$copy = $DTemp.clone().removeClass('hidden');
					$copy.find('img.img-responsive').prop('src', 'http://mobileapi.foodiesys.com/foodie-mssql/pics/'+resData[i].image1);
					$copy.find('h4.dishTitle').html(resData[i].dish_name);
					//$copy.find('a.dishTitle').prop('rel', resData[i].id );
					//$copy.find('.btnReserve').prop('data-dish', resData[i].id );
					$copy.find('div.byChef').html( 'From <a href="chef_profile.html?id='+resData[i].chef_id+'">' + resData[i].company + '</a>' );
					
					var H = '';
					
					H += 'Price : $'+resData[i].unit_price+' x '+resData[i].quantity + ' = $' + resData[i].total_price + '<br />' ;
					H += 'Payment status : <strong>'+resData[i].status+'</strong>';
					if( resData[i].status == 'Paid' ){
						H += '<br/>Delivary Code : <strong>'+resData[i].delivary_code+'</strong>';	
					}
					if( resData[i].status == 'Finished' ){
						H += ' &nbsp; <button class="btn btn-xs btnFinish" data-rid="'+resData[i].rid+'"><i class="fa fa-comment"></i> Rate it </button>';
					}
					
					H += '<h4>Time : '+resData[i].d_date+' &nbsp; '+resData[i].d_time+'</h4>';
					
					$copy.find('p.dishInfo').html( H );
					
											
					
					$copy.appendTo('#chef-foods');
				}
				//$DTemp.remove();
			}else{
				$('#chef-foods').html('<center>No Rocord Found!</center>');
			}
		}else { 
			BAlert.find('.modal-header h3').html('<i class="fa fa-exclamation-triangle"></i> Error');
			BAlert.find('.modal-body').html('<p class="text-danger">'+data.Msg+'</p>');
			BAlert.modal();
		}
		if (data.JS) { eval(data.JS); }
	
	}); // ajax	
}

</script>
</body>
</html>